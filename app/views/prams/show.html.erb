<div class="container">
  <div class="row py-5">
    <div class="col-md-6 text-block">
      <p class="text-primary"><i class="fa-map-marker-alt fa mr-1 text-primary"></i>
        <%= @pram.location %></p>
      <h1> <%= @pram.brand %> <%= @pram.model %> </h1>
        <div class="card-rating-show">
          <% if @pram.reviews.present?%>

          <% avg_score = @pram.reviews.average(:score).to_i %>
          <% avg_score_float = @pram.reviews.average(:score).to_f.round(2) %>

            <div class="text-warning">
              <% avg_score.times do %>
                <i class="fas fa-star"></i>
              <% end %>
                <% (5 - avg_score).times do %>
                  <i class="far fa-star"></i>
                <% end %>
            </div>
              <h6 id="rating-float">(<%= avg_score_float%>)</h6>

          <% else %>

            <p id="no-reviews">No reviews yet</p>

          <% end %>
        </div>

        <div class="owner-row">
          <div class="owner-row-left">
          <% if @pram.user == current_user %>
            <% if @pram.user.photo.attached? %>
              <%= cl_image_tag @pram.user.photo.key, class:"avatar-small" %>
            <% else %>
              <%= image_tag "default_avatar.png", class:"avatar-small" %>
            <% end %>
            <p class="text-muted font-weight-light">You</p>
          <% else %>
            <% if @pram.user.photo.attached? %>
              <%= cl_image_tag @pram.user.photo.key, class:"avatar-small" %>
            <% else %>
              <%= image_tag "default_avatar.png", class:"avatar-small" %>
            <% end %>
            <p class="text-muted font-weight-ligh"><%= @pram.user.first_name%> <%= @pram.user.last_name%></p>
          <% end %>
        </div>

        <div class="owner-row-right">
          <% if current_user == @pram.user %>
            <%=link_to pram_path(@pram), method: :delete, data: { confirm: "Are you sure?" } do %>
              <i class="fas fa-trash-alt"></i>
            <%end%>
          <%end %>
        </div>

        </div>
      <hr>
      <h6 class="mb-3">The pram</h6>
      <p class="text-muted font-weight-light"><%= @pram.description %></p>
      <p class="text-muted">
        <span class="text-primary h2"><%= @pram.price %> $</span> per day</p>
        <div id='pram-booking-dates' data-unavailable="<%= @pram.unavailable_dates.to_json %>">
            <% if current_user.id != @pram.user_id  %>
               <%= simple_form_for([@pram, @booking]) do |f| %>
                   <%= f.input :start_day, as: :string, type: :text %>
                   <%= f.input :end_day, as: :string, type: :text %>
                   <%= f.submit "Book", class: "btn btn-flat button-book", html: {id: :check_submit} %>
                <% end %>
            <% end %>
         </div>

    </div>

    <div class="col-md-6">
      <% if @pram.photos.attached? %>
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100" src="<%= cl_image_path @pram.photos[0].key, height: 300, width: 400, crop: :fill%>" >
            </div>
            <% @pram.photos[1..-1].each do |picture| %>
              <div class="carousel-item">
                <img class="d-block w-100" src="<%= cl_image_path picture.key, height: 300, width: 400, crop: :fill%>" >
              </div>
            <% end %>
          </div>
          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
        <% else %>
          <div class="main-card-picture" id="default-pram" style="background-image: url('<%= image_path "default-pram.jpg" %>')">
          </div>
      <% end %>
    </div>
  </div>
</div>
<%= render 'shared/footer' %>

